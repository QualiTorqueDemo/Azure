spec_version: 2
description: >
  Deploy a Virtual Network in Azure with 3 subnets, NSG, route table, 
  service endpoints, subnet delegation, and private link policies.
metadata:
  blueprint-labels:
    - key: hypervisor
      value: Azure
    - key: Terraform

inputs:
  agent:
    type: string
    description: "Select the Torque agent to deploy this environment"
    default: "aks-prod"
    allowed-values:
      - aks-prod
      - aks-dev-temp
  Azure Location:
    type: string
    description: "Azure location for the VNet"
    default: "westus2"
    allowed-values:
      - northcentralus
      - swedencentral
      - francecentral
      - northeurope
      - westus
      - westus2

outputs:
  VNet ID:
    value: '{{ .grains.virtual-network.outputs.test_vnet_id }}'
    quick: true

grains:
  virtual-network:
    kind: terraform
    spec:
      source:
        store: Azure
        path: assets/virtual-network
      agent:
        name: '{{ .inputs.agent }}'
      inputs:
        - vnet_location: '{{ .inputs.["Azure Location"] }}'
      outputs:
        - test_vnet_id
